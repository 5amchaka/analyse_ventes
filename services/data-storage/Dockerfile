# -------------------------------------------------------------------
# ğŸ—„ï¸ Service de stockage de donnÃ©es SQLite
# -------------------------------------------------------------------
  FROM alpine:3.19

  # ğŸ“¦ Installation des dÃ©pendances
  RUN apk update && \
      apk add --no-cache \
          sqlite \
          sudo && \
      rm -rf /var/cache/apk/*
  
  # ğŸ‘¤ CrÃ©ation de l'utilisateur non-root (configurable)
  ARG USER_ID=1000
  ARG GROUP_ID=1000
  
  RUN addgroup -g ${GROUP_ID} dbgroup && \
      adduser -D -u ${USER_ID} -G dbgroup dbuser && \
      echo 'dbuser ALL=(ALL) NOPASSWD: /bin/chown, /bin/mkdir' >> /etc/sudoers
  
  # ğŸ“ PrÃ©paration de l'environnement
  WORKDIR /app
  RUN mkdir -p /app && \
      chown dbuser:dbgroup /app
  
  # ğŸ“‚ Copie des fichiers
  COPY --chown=dbuser:dbgroup services/data-storage/entrypoint.sh /entrypoint.sh
  RUN chmod +x /entrypoint.sh
  
  # ğŸ—ƒï¸ Configuration des volumes
  VOLUME /app/database
  
  # ğŸš€ Configuration runtime
  USER dbuser
  ENTRYPOINT ["/entrypoint.sh"]